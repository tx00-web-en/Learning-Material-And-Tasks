# Activity 2

Prepare documentation for the Jobs API server, which was a part of Monday's pair programming. The server's source code can be found [here](https://github.com/tx00-resources-en/week7-bepp-starter). Here are some instructions to guide you:
 
### **Part 1: Using LLM**

1. **Try the Prompt with LLM**:
   - You are expected to use a specific prompt ( available in [`prompt.md`](./prompt.md)) with your favorite Large Language Model (LLM) to generate a Swagger/OpenAPI document. 
   - The output should be similar to these examples: [ChatGPT](./swagger1.md) and [Bing CoPilot](./swagger2.md).

2. **Install `swagger-ui-express`**:
   - Install the required package for serving Swagger documentation in your Express app:
   ```bash
   npm install swagger-ui-express
   ```

3. **Include Swagger in Your Main Application File**:
   - In the main app file (e.g., `app.js` or `server.js`), require the Swagger UI package and load the Swagger JSON:
   ```javascript
   const swaggerUI = require("swagger-ui-express");
   const swaggerSpec = require("./swagger.json");  // Assuming swagger.json is in the same directory
   ```

4. **Serve Swagger Documentation**:
   - After defining your routes, add the following middleware to serve the Swagger UI at the `/api-docs` endpoint:
   ```javascript
   app.use("/api-docs", swaggerUI.serve, swaggerUI.setup(swaggerSpec));
   ```

5. **Generate Swagger JSON**:
   - Create a `swagger.json` file based on the output generated by the LLM. The JSON file should describe all the routes, models, and security configurations of your Jobs API.

6. **Test the Endpoints**:
   - Ensure that the Swagger UI documentation is properly integrated by accessing `localhost:4000/api-docs/` in your browser and test all the endpoints through the interface.

**Important Note**:
- The generated Swagger JSON will indicate that **all routes are protected by authentication**. However, if some routes (e.g., login or signup) should be publicly accessible, you can manually update the `swagger.json` by overriding specific routes with:
  ```json
  "security": [],
  ```

**Sample Solution**:

Hereâ€™s how the final [`swagger.json`](./swagger.json) file might look. Please note the following:

1. **User Routes Not Protected**:  
   The user routes are not protected, as indicated by `"security": []`. Similarly, the `GET /job` route is not protected.

2. **Adding Example Entries**:  
   To include example values for fields like **password** and **phone number**, you can use the following format in the `swagger.json`:
   ```json
   "password": { "type": "string", "format": "password", "example": "7w8Gf4=Vr-" },
   "phone_number": { "type": "string", "example": "040 547 578" }
   ```

---

### **Next Steps**:
1. Use the LLM to generate the Swagger documentation based on the source code of your API.
2. Integrate the generated Swagger UI into your Express server by following the installation and configuration steps.
3. Ensure that you adjust the security configuration in the Swagger JSON file as needed.

---

### (Optional) Part 2: Manual 

1. Begin by reviewing the source code for the workout v2 sever ([below](#code-for-the-workout-server)).
2. install the following packages: `swagger-ui-express`
    ```sh
    npm install swagger-ui-express
    ```
3. Modify the swagger.json [below](#swaggerjson) file accordingly. You can use the [Swagger Editor](https://editor.swagger.io/) for this purpose. 
4. In your main application file, add the following code:

```javascript
// Swagger
const swaggerUI = require("swagger-ui-express");
const swaggerSpec = require("./swagger.json");
```

After defining your routes, add the following line:
```javascript
app.use("/api-docs", swaggerUI.serve, swaggerUI.setup(swaggerSpec));
```

5. Test the endpoints


-------
### Code for the workout server

```js
const config = require("./utils/config");
const express = require("express");
const mongoose = require("mongoose");
const cors = require("cors");
const workoutRoutes = require("./routes/workouts");
const userRoutes = require("./routes/user");
const logger = require("./utils/logger");

// Swagger
const swaggerUI = require("swagger-ui-express");
const swaggerSpec = require("./swagger.json");


// express app
const app = express();

// middleware
app.use(express.json());
app.use(cors());

app.use((req, res, next) => {
  logger.info(req.path, req.method);
  next();
});

// routes
app.use("/api/user", userRoutes);
app.use("/api/workouts", workoutRoutes);
app.use("/api-docs", swaggerUI.serve, swaggerUI.setup(swaggerSpec));

app.get("/", (req, res) => {
  res.send("<h1>Hello World!</h1>");
});

// connect to db
logger.info("connecting to", config.MONGO_URI);
mongoose
  .connect(config.MONGO_URI)
  .then(() => {
    logger.info("connected to db");
  })
  .catch((error) => {
    logger.error(error);
  });

module.exports = app;
```


-------
### Swagger.json

```json
{
    "openapi": "3.0.0",
    "info": {
      "title": "Workouts API",
      "contact": {},
      "version": "1.0"
    },
    "servers": [
      {
        "url": "http://localhost:4000/api",
        "variables": {}
      }
    ],
    "paths": {
      "/user/signup": {
        "post": {
          "tags": [
            "Auth"
          ],
          "summary": "Register User",
          "operationId": "RegisterUser",
          "parameters": [],
          "requestBody": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegisterUserRequest"
                },
                "example": {
                  "name": "bob",
                  "email": "bob@gmail.com",
                  "password": "4wa95#Cf-"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false,
          "security": []
        }
      },
      "/user/login": {
        "post": {
          "tags": [
            "Auth"
          ],
          "summary": "Login User",
          "operationId": "LoginUser",
          "parameters": [],
          "requestBody": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginUserRequest"
                },
                "example": {
                  "email": "susan@gmail.com",
                  "password": "secret"
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false,
          "security": []
        }
      },
      "/workouts": {
        "post": {
          "tags": [
            "Workouts"
          ],
          "summary": "Create Workout",
          "operationId": "CreateWorkout",
          "parameters": [],
          "requestBody": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateWorkoutRequest"
                },
                "example": {
                  "title": "Sample Workout",
                  "reps": 10,
                  "load": 50
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false
        },
        "get": {
          "tags": [
            "Workouts"
          ],
          "summary": "Get All Workouts",
          "operationId": "GetAllWorkouts",
          "parameters": [],
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false
        }
      },
      "/workouts/{id}": {
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "schema": {
              "type": "string"
            },
            "required": true,
            "description": "The Workout ID"
          }
        ],
        "get": {
          "tags": [
            "Workouts"
          ],
          "summary": "Get Single Workout",
          "operationId": "GetSingleWorkout",
          "parameters": [],
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false
        },
        "patch": {
          "tags": [
            "Workouts"
          ],
          "summary": "Update Workout",
          "operationId": "UpdateWorkout",
          "parameters": [],
          "requestBody": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateWorkoutRequest"
                },
                "example": {
                  "title": "Random Workout",
                  "reps": 1,
                  "load": 5
                }
              }
            },
            "required": true
          },
          "responses": {
            "200": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false
        },
        "delete": {
          "tags": [
            "Workouts"
          ],
          "summary": "Delete Workout",
          "operationId": "DeleteWorkout",
          "parameters": [],
          "responses": {
            "204": {
              "description": "",
              "headers": {}
            }
          },
          "deprecated": false
        }
      }
    },
    "components": {
      "schemas": {
        "RegisterUserRequest": {
          "title": "RegisterUserRequest",
          "required": [
            "name",
            "email",
            "password"
          ],
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "email": {
              "type": "string"
            },
            "password": {
              "type": "string"
            }
          },
          "example": {
            "name": "bob",
            "email": "bob@gmail.com",
            "password": "4wa95#Cf-"
          }
        },
        "LoginUserRequest": {
          "title": "LoginUserRequest",
          "required": [
            "email",
            "password"
          ],
          "type": "object",
          "properties": {
            "email": {
              "type": "string"
            },
            "password": {
              "type": "string"
            }
          },
          "example": {
            "email": "bob@gmail.com",
            "password": "4wa95#Cf-"
          }
        },
        "CreateWorkoutRequest": {
          "title": "CreateWorkoutRequest",
          "required": [
            "title",
            "reps",
            "load"
          ],
          "type": "object",
          "properties": {
            "title": {
              "type": "string"
            },
            "reps": {
              "type": "integer"
            },
            "load": {
              "type": "integer"
            }
          },
          "example": {
            "tille": "Push ups",
            "reps": 40,
            "load": 5
          }
        },
        "UpdateWorkoutRequest": {
          "title": "UpdateWorkoutRequest",
          "required": [
            "tille",
            "reps",
            "load"
          ],
          "type": "object",
          "properties": {
            "tille": {
              "type": "string"
            },
            "reps": {
              "type": "integer"
            },
            "load": {
              "type": "integer"
            }
          },
          "example": {
            "tille": "random",
            "reps": 4,
            "load": 25
          }
        }
      },
      "securitySchemes": {
        "httpBearer": {
          "type": "http",
          "scheme": "bearer"
        }
      }
    },
    "security": [
      {
        "httpBearer": []
      }
    ],
    "tags": [
      {
        "name": "Auth",
        "description": ""
      },
      {
        "name": "Workouts",
        "description": ""
      }
    ]
  }
```